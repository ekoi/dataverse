<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:o="http://omnifaces.org/ui"
      xmlns:p="http://primefaces.org/ui"
      xmlns:jsf="http://xmlns.jcp.org/jsf">

    <h:head>
    </h:head>

    <h:body>
        <f:metadata>
            <f:viewParam name="redirectPage" value="#{LoginPage.redirectPage}"/>
            <f:viewAction action="#{LoginPage.init}"/>
        </f:metadata>
        <ui:composition template="/dataverse_template.xhtml">
            <ui:param name="pageTitle" value="#{bundle.login} - #{dataverseServiceBean.findRootDataverse().name} #{bundle.dataverse}"/>
            <ui:param name="showDataverseHeader" value="false"/>
            <ui:param name="showMessagePanel" value="#{true}"/>
            <ui:param name="loginRedirectPage" value="dataverse.xhtml"/>
            <ui:define name="body">
                <ui:fragment rendered="#{LoginPage.listAuthenticationProviders().size() lt 1}">
                    <div class="row">
                        <div class="col-sm-12">
                            <div class="alert alert-danger">
                                <h:outputFormat value="#{bundle['authenticationProvidersAvailable.tip']}" escape="false">
                                    <f:param value="&lt;h3&gt;"/>
                                    <f:param value="&lt;/h3&gt;"/>
                                    <f:param value="&lt;br /&gt;"/>
                                </h:outputFormat>
                            </div>
                        </div>
                    </div>
                </ui:fragment>
			<div jsf:id="login-container" class="row">

				<div class="panel panel-default highlight col-md-12">
					
					<div class="panel-body row col-md-offset-4">

						<div id="builtinColumn" class="panel panel-default highlight col-md-6">

							<div class="help-block">Only if you can't use institutional account, please login via email address and password</div>

							<div id="builtinProvider"
								jsf:rendered="#{LoginPage.authProvider.id == 'builtin'}">
								<h:form id="loginForm" styleClass="form-horizontal">
									<p:focus context="loginForm" />
									<ui:remove>
										<ui:fragment
											rendered="#{LoginPage.multipleProvidersAvailable}">
											<div class="form-group text-left">
												<label class="col-sm-4 control-label"
													for="loginSystemSelect"> #{bundle['login.System']}
												</label>
												<div class="col-sm-8">
													<h:selectOneMenu id="loginSystemSelect"
														styleClass="form-control"
														value="#{LoginPage.credentialsAuthProviderId}">
														<f:selectItems
															value="#{LoginPage.listCredentialsAuthenticationProviders()}"
															var="ap" itemLabel="#{ap.title}" itemValue="#{ap.id}" />
														<f:ajax render="@all"
															listener="#{LoginPage.resetFilledCredentials}" />
													</h:selectOneMenu>
												</div>
											</div>
										</ui:fragment>
									</ui:remove>
									<ui:repeat id="credentialsContainer"
										value="#{LoginPage.filledCredentials}" var="fc">
										<div class="form-group text-left">
											<label class="col-sm-4 control-label" for="credValue">
												#{fc.credential.title} </label>
											<div class="col-sm-8">
												<h:inputText rendered="#{not fc.credential.secret}"
													value="#{fc.value}" id="credValue"
													styleClass="form-control" />
												<p:message rendered="#{not fc.credential.secret}"
													for="credValue" display="text" />
												<h:inputSecret rendered="#{fc.credential.secret}"
													value="#{fc.value}" id="sCredValue"
													styleClass="form-control" />
												<p:message rendered="#{not fc.credential.secret}"
													for="sCredValue" display="text" />
											</div>
										</div>
									</ui:repeat>

									<!-- validation -->
									<div class="form-group" jsf:rendered="#{LoginPage.requireExtraValidation}">
										<div class="col-sm-offset-4 col-sm-8">
											<p>
												<h:outputText styleClass="highlightBold" value="#{bundle['contact.question']}"/> <span class="glyphicon glyphicon-asterisk text-danger" title="#{bundle.requiredField}"/>
											</p>
											<h:outputFormat value="#{LoginPage.op1} + #{LoginPage.op2} = "/>
											<p:inputText id="messageSum" label="Sum" size="4" value="#{LoginPage.userSum}" converterMessage="#{bundle['contact.sum.converterMessage']}"
														 required="#{param['DO_VALIDATION']}" requiredMessage="#{bundle['contact.sum.required']}"
														 validatorMessage="#{bundle['contact.sum.invalid']}" validator="#{LoginPage.validateUserSum}">
												<f:convertNumber integerOnly="true" type="number"/>
											</p:inputText>
											<h:message for="messageSum" styleClass="bg-danger text-danger"/>
										</div>
									</div>

									<div class="form-group">
										<div class="col-sm-offset-4 col-sm-9">
											<p:commandButton id="login" styleClass="btn btn-default"
												value="#{bundle.login}" update="@all"
												action="#{LoginPage.login}" />
										</div>
									</div>
									<div class="form-group">
										<div class="col-sm-offset-4 col-sm-9">
											<a href="passwordreset.xhtml">
												#{bundle['login.forgot.text']} </a>
										</div>
									</div>
									<div class="help-block">Only if your institute isn't connected via SURFconext, create an account.</div>
									<div class="form-group">
										<div class="col-sm-offset-4 col-sm-9">
											<a class="btn btn-default" href="#{dataverseHeaderFragment.getSignupUrl(navigationWrapper.redirectPage)}">
												 #{bundle['header.signUp']} </a>
										</div>
									</div>
								</h:form>
							</div>

						</div>



					</div>
				</div>
			</div>
		</ui:define>
        </ui:composition>
    </h:body>
</html>

